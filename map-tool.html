<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì£¼ì†Œ â†’ ì¢Œí‘œ ë³€í™˜ê¸°</title>
  <!-- ë„¤ì´ë²„ë§µ Client ID ì ìš©ë¨ -->
  <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=RdtGeOaqj2HzA5p7udkQ"></script>
  <style>
    body { font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans KR",sans-serif; padding:20px; max-width:600px; margin:0 auto; }
    #map { width:100%; height:400px; border-radius:12px; margin:20px 0; }
    .address-input { width:100%; padding:12px; border:1px solid #ddd; border-radius:8px; font-size:16px; box-sizing:border-box; }
    .btn { background:#03c75a; color:#fff; border:none; padding:12px 24px; border-radius:8px; font-size:16px; font-weight:500; cursor:pointer; margin:10px 0; }
    .btn:hover { background:#04d764; }
    .btn:disabled { background:#ccc; cursor:not-allowed; }
    .result { background:#f0f9f4; padding:16px; border-radius:8px; margin:10px 0; border-left:4px solid #03c75a; }
    .coords { font-family:monospace; background:#333; color:#0f0; padding:8px; border-radius:4px; word-break:break-all; }
  </style>
</head>
<body>
  <h2>ğŸ  ì£¼ì†Œ â†’ ì¢Œí‘œ ë³€í™˜ (ë„¤ì´ë²„ì§€ë„)</h2>
  
  <input type="text" id="address" class="address-input" placeholder="ë„ë¡œëª…ì£¼ì†Œ ì…ë ¥ (ì˜ˆ: ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123)">
  <br>
  <button class="btn" onclick="geocodeAddress()">ğŸ“ ì¢Œí‘œ ì°¾ê¸° & ë³µì‚¬</button>
  
  <div id="map"></div>
  <div id="result" class="result" style="display:none;">
    <strong>âœ… ì¢Œí‘œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!</strong><br>
    <div id="coords" class="coords"></div>
    <small>ì´ ê°’ì„ ë…¸ì…˜ Lat, Lng í•„ë“œì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”: <code>37.5665</code> <code>126.9780</code></small>
  </div>

  <script>
    let map, marker;

    // URL íŒŒë¼ë¯¸í„°ì—ì„œ ì£¼ì†Œ ìë™ ì…ë ¥
    const urlParams = new URLSearchParams(window.location.search);
    const paramAddress = urlParams.get('address');
    if (paramAddress) {
      document.getElementById('address').value = decodeURIComponent(paramAddress);
      setTimeout(geocodeAddress, 800); // 0.8ì´ˆ í›„ ìë™ ì‹¤í–‰
    }

    function geocodeAddress() {
      const address = document.getElementById('address').value.trim();
      if (!address) {
        alert('ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
        return;
      }

      const btn = document.querySelector('.btn');
      btn.disabled = true;
      btn.textContent = 'â³ ì°¾ëŠ” ì¤‘...';
      
      // ë„¤ì´ë²„ ì§€ì˜¤ì½”ë”© API
      naver.maps.Service.geocode({
        query: address
      }, function(status, response) {
        btn.disabled = false;
        btn.textContent = 'ğŸ“ ì¢Œí‘œ ì°¾ê¸° & ë³µì‚¬';
        
        if (status === naver.maps.Service.Status.OK) {
          const result = response.v2.addresses[0];
          const lat = parseFloat(result.y);
          const lng = parseFloat(result.x);
          
          showMap(lat, lng, result.roadAddress || result.jibunAddress);
          copyCoords(lat, lng);
        } else {
          alert('ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\në„ë¡œëª…ì£¼ì†Œë¡œ ë‹¤ì‹œ ì…ë ¥í•´ë³´ì„¸ìš”.\nì˜ˆ: "ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123"\n\në˜ëŠ” ê±´ë¬¼ëª…ì´ í¬í•¨ëœ ì •í™•í•œ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        }
      });
    }

    function showMap(lat, lng, addressName) {
      const mapContainer = document.getElementById('map');
      const mapOptions = {
        center: new naver.maps.LatLng(lat, lng),
        zoom: 17
      };
      
      map = new naver.maps.Map(mapContainer, mapOptions);
      
      marker = new naver.maps.Marker({
        position: new naver.maps.LatLng(lat, lng),
        map: map,
        icon: {
          url: 'https://maps.naver.com/apps/citypicker/img/pin_red_n.png',
          size: new naver.maps.Size(24, 35),
          origin: new naver.maps.Point(0, 0),
          anchor: new naver.maps.Point(12, 35)
        }
      });
      
      const infoWindow = new naver.maps.InfoWindow({
        content: `<div style="padding:10px;font-size:13px;"><strong>${addressName}</strong></div>`
      });
      
      naver.maps.Event.addListener(marker, 'click', function() {
        if (infoWindow.getMap()) {
          infoWindow.close();
        } else {
          infoWindow.open(map, marker);
        }
      });
    }

    function copyCoords(lat, lng) {
      const coordText = `${lat.toFixed(6)},${lng.toFixed(6)}`;
      navigator.clipboard.writeText(coordText).then(() => {
        document.getElementById('coords').textContent = coordText;
        document.getElementById('result').style.display = 'block';
        document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
      }).catch((err) => {
        console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
        prompt('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨. ì§ì ‘ ë³µì‚¬í•˜ì„¸ìš”:', coordText);
      });
    }

    // ì—”í„°í‚¤ ì§€ì›
    document.getElementById('address').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') geocodeAddress();
    });

    // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í™•ì¸
    window.addEventListener('load', () => {
      console.log('âœ… ë„¤ì´ë²„ë§µ SDK ë¡œë”© ì™„ë£Œ');
    });
  </script>
</body>
</html>
