<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>주소→좌표</title>
</head>
<body>
<input id="address" placeholder="주소 입력">
<button onclick="findCoords()">좌표 찾기</button>
<div id="map" style="height:400px;"></div>
<div id="coords" style="display:none;"></div>

<script>
// 비동기 로드로 Parser-blocking 해결
const script = document.createElement('script');
script.src = 'https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=q581f6wc1o&ncpClientSecret=0W7Ouyl18C6u2N8B5gJ93MQfj0za0feYNLYOYF6c&submodules=geocoder';
script.async = true;
script.onload = initMap;
document.head.appendChild(script);

function initMap() {
  console.log('네이버 지도 API 로드 완료');
}

function findCoords() {
  const address = document.getElementById('address').value.trim();
  if (!address) return alert('주소 입력!');
  
  if (!window.naver?.maps?.Service) {
    alert('지도 API 로딩중... 잠시 후 다시');
    return;
  }
  
  naver.maps.Service.geocode({
    query: address
  }, function(status, response) {
    if (status === naver.maps.Service.Status.OK) {
      const result = response.v2.addresses[0];
      const lat = parseFloat(result.y);
      const lng = parseFloat(result.x);
      
      // 좌표 표시
      document.getElementById('coords').textContent = `${lat.toFixed(6)},${lng.toFixed(6)}`;
      document.getElementById('coords').style.display = 'block';
      
      // 지도 표시
      const map = new naver.maps.Map('map', {
        center: new naver.maps.LatLng(lat, lng),
        zoom: 17
      });
      
      new naver.maps.Marker({
        position: new naver.maps.LatLng(lat, lng),
        map: map
      });
      
    } else {
      alert('실패: ' + status + '\n\n네이버 클라우드 IP 제한 설정 필요');
    }
  });
}

document.getElementById('address').addEventListener('keypress', e => {
  if (e.key === 'Enter') findCoords();
});
</script>
</body>
</html>
