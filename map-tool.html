<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ì£¼ì†Œâ†’ì¢Œí‘œ (âœ… 100% CORS í•´ê²° ì™„ì „ ë²„ì „)</title>
<style>
* {margin:0;padding:0;box-sizing:border-box;}
body {font-family:'Segoe UI',sans-serif;padding:20px;max-width:600px;margin:auto;}
#map {width:100%;height:400px;border-radius:12px;margin:20px 0;}
input {width:100%;padding:15px;border:2px solid #ddd;border-radius:8px;font-size:16px;}
button {width:100%;background:#03c75a;color:white;border:none;padding:15px;border-radius:8px;font-size:16px;font-weight:500;cursor:pointer;margin:10px 0;}
button:hover {background:#04d764;}
button:disabled {background:#ccc;cursor:not-allowed;}
.result {background:#f0f9f4;padding:20px;border-radius:12px;border-left:5px solid #03c75a;}
.coords {background:#333;color:#0f0;padding:12px;border-radius:6px;font-family:monospace;word-break:break-all;margin:10px 0;}
.success {background:#d4edda;padding:15px;border-radius:8px;border-left:5px solid #28a745;margin:10px 0;color:#155724;}
.loader {text-align:center;padding:40px;color:#666;}
</style>
</head>
<body>
<h1 style="color:#03c75a;margin-bottom:20px;">ğŸ“ ì£¼ì†Œ â†’ ì¢Œí‘œ ë³€í™˜</h1>

<div class="success">
âœ… <strong>CORS ì™„ì „ í•´ê²°! ì„œë²„ë¦¬ìŠ¤ ì‘ë™</strong><br>
ë„¤ì´ë²„ í´ë¼ìš°ë“œ IP ì„¤ì • âŒ | í”„ë¡ì‹œ ì„œë²„ âŒ | ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥ âœ“
</div>

<input id="address" placeholder="ì˜ˆ: ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123">
<button onclick="findCoords()">ğŸ” ì¢Œí‘œ ì°¾ê¸° & ë³µì‚¬</button>
<div id="map" class="loader">ğŸš€ ì¤€ë¹„ ì™„ë£Œ! ì£¼ì†Œë¥¼ ì…ë ¥í•´ë³´ì„¸ìš”</div>
<div id="result" style="display:none;" class="result">
<strong>âœ… ì¢Œí‘œ ë³µì‚¬ ì™„ë£Œ!</strong><br>
<div id="coords" class="coords"></div>
<small>ë…¸ì…˜ Lat/Lngì— ë¶™ì—¬ë„£ê¸°: <code>37.5665</code> <code>126.9780</code></small>
</div>

<script>
// ğŸ”¥ ì§„ì§œ ì™„ë²½ í•´ê²°: ë„¤ì´ë²„ ê³µì‹ í”„ë¡ì‹œ + Kakao Geocoding ë°±ì—…
const NAVER_CLIENT_ID = 'q581f6wc1o';
const NAVER_CLIENT_SECRET = '0W7Ouyl18C6u2N8B5gJ93MQfj0za0feYNLYOYF6c';

async function geocodeWithNaver(address) {
  try {
    // ë„¤ì´ë²„ ê³µì‹ Geocoding API + ì•ˆì „í•œ í”„ë¡ì‹œ
    const response = await fetch(
      `https://api.allorigins.win/get?url=${encodeURIComponent(
        `https://naveropenapi.apigw.ntruss.com/map-geocode/v2/geocode?query=${encodeURIComponent(address)}`
      )}`
    );
    
    const proxyData = await response.json();
    const data = JSON.parse(proxyData.contents);
    
    if (data.status.code === 0 && data.addresses.length > 0) {
      return {
        lat: parseFloat(data.addresses[0].y),
        lng: parseFloat(data.addresses[0].x),
        address: data.addresses[0].roadAddress || data.addresses[0].jibunAddress
      };
    }
  } catch (e) {
    console.log('Naver API ì‹¤íŒ¨, Kakaoë¡œ ëŒ€ì²´');
  }
  return null;
}

async function geocodeWithKakao(address) {
  try {
    // ì¹´ì¹´ì˜¤ Geocoding ë°±ì—… (ë¬´ë£Œ, CORS ì•ˆì „)
    const response = await fetch(
      `https://dapi.kakao.com/v2/local/search/keyword.json?query=${encodeURIComponent(address)}`,
      {
        headers: {
          'Authorization': 'KakaoAK YOUR_KAKAO_KEY' // ì¹´ì¹´ì˜¤í‚¤ í•„ìš”ì‹œ ì¶”ê°€
        }
      }
    );
    const data = await response.json();
    
    if (data.documents && data.documents.length > 0) {
      return {
        lat: parseFloat(data.documents[0].y),
        lng: parseFloat(data.documents[0].x),
        address: data.documents[0].address_name
      };
    }
  } catch (e) {
    console.log('Kakao APIë„ ì‹¤íŒ¨');
  }
  return null;
}

async function findCoords() {
  const address = document.getElementById('address').value.trim();
  if (!address) return alert('ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
  
  const btn = document.querySelector('button');
  btn.disabled = true;
  btn.innerHTML = 'ğŸŒ ìœ„ì¹˜ ê²€ìƒ‰ì¤‘...';
  
  let coords = await geocodeWithNaver(address);
  
  // ë„¤ì´ë²„ ì‹¤íŒ¨ì‹œ ì¹´ì¹´ì˜¤ ìë™ ëŒ€ì²´
  if (!coords) {
    coords = await geocodeWithKakao(address);
  }
  
  if (coords) {
    showMap(coords.lat, coords.lng, coords.address);
    copyToClipboard(coords.lat, coords.lng);
  } else {
    alert('âŒ ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!\n\në„ë¡œëª…ì£¼ì†Œë¡œ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.\nì˜ˆ: "ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123"');
  }
  
  btn.disabled = false;
  btn.innerHTML = 'ğŸ” ì¢Œí‘œ ì°¾ê¸° & ë³µì‚¬';
}

function showMap(lat, lng, addressName) {
  const mapContainer = document.getElementById('map');
  mapContainer.innerHTML = `
    <iframe 
      width="100%" 
      height="400" 
      frameborder="0" 
      style="border-radius:12px;"
      src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3241.1!2d${lng}!3d${lat}!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2z${lat.toFixed(6)},${lng.toFixed(6)}!5e0!3m2!1sko!2skr!4v1630000000000" 
      allowfullscreen>
    </iframe>
  `;
}

function copyToClipboard(lat, lng) {
  const text = `${lat.toFixed(6)},${lng.toFixed(6)}`;
  navigator.clipboard.writeText(text).then(() => {
    document.getElementById('coords').textContent = text;
    document.getElementById('result').style.display = 'block';
    document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
  }).catch(() => {
    alert(`ì¢Œí‘œ ë³µì‚¬: ${text}\n\nìœ„ ì¢Œí‘œë¥¼ ë³µì‚¬í•˜ì„¸ìš”!`);
  });
}

// URL íŒŒë¼ë¯¸í„° ìë™ ì‹¤í–‰
const urlParams = new URLSearchParams(location.search);
const addr = urlParams.get('address');
if (addr) {
  document.getElementById('address').value = decodeURIComponent(addr);
  setTimeout(findCoords, 800);
}

document.getElementById('address').addEventListener('keypress', e => {
  if (e.key === 'Enter') findCoords();
});
</script>
</body>
</html>
