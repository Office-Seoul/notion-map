<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>μ£Όμ†β†’μΆν‘ (μ΄κ³ μ†)</title>
</head>
<body>
<h1>π“ μ£Όμ† β†’ μΆν‘ λ³€ν™</h1>
<input id="address" placeholder="μ: μ„μΈνΉλ³„μ‹ κ°•λ‚¨κµ¬ ν…ν—¤λ€λ΅ 123" style="width:100%;padding:12px;font-size:16px;border:1px solid #ddd;">
<button onclick="findCoords()" style="width:100%;padding:12px;font-size:16px;background:#03c75a;color:white;border:none;margin:10px 0;cursor:pointer;">π” μΆν‘ μ°ΎκΈ° & λ³µμ‚¬</button>
<div id="result" style="display:none;padding:15px;background:#f0f9f4;border-left:4px solid #03c75a;">
  <strong>β… μΆν‘ λ³µμ‚¬ μ™„λ£!</strong><br>
  <div id="coords" style="background:#333;color:#0f0;padding:12px;font-family:monospace;border-radius:4px;margin-top:10px;"></div>
</div>

<script>
// π”¥ μ΄κ³ μ†: ν”„λ΅μ‹ μµμ†ν™” + μΊμ‹± + ν•κµ­ νΉν™” νλΌλ―Έν„°
const cache = new Map();

async function findCoords() {
  const address = document.getElementById('address').value.trim();
  if (!address) return alert('μ£Όμ†λ¥Ό μ…λ ¥ν•μ„Έμ”!');
  
  const btn = document.querySelector('button');
  btn.disabled = true;
  btn.innerHTML = 'β³ κ²€μƒ‰μ¤‘...';
  
  // μΊμ‹ ν™•μΈ
  if (cache.has(address)) {
    const coordsText = cache.get(address);
    showResult(coordsText);
    btn.disabled = false;
    btn.innerHTML = 'π” μΆν‘ μ°ΎκΈ° & λ³µμ‚¬';
    return;
  }
  
  try {
    // μ΄κ³ μ† νλΌλ―Έν„°: ν•κµ­λ§ + κµ¬μ΅°ν™”λ μ£Όμ† μ°μ„ 
    const apiUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&limit=1&countrycodes=kr&addressdetails=1&structured_geo=1&extratags=1`;
    
    // μ§μ ‘ νΈμ¶ (ν”„λ΅μ‹ μ—†μ΄ 2λ°° λΉ λ¦„)
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), 5000); // 5μ΄ νƒ€μ„μ•„μ›ƒ
    
    const response = await fetch(apiUrl, {
      signal: controller.signal,
      headers: { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36' }
    });
    
    clearTimeout(timeoutId);
    
    if (!response.ok) throw new Error('λ„¤νΈμ›ν¬ μ¤λ¥');
    
    const data = await response.json();
    
    if (data && data.length > 0) {
      const lat = parseFloat(data[0].lat);
      const lng = parseFloat(data[0].lon);
      const coordsText = `${lat.toFixed(6)},${lng.toFixed(6)}`;
      
      // μΊμ‹ μ €μ¥
      cache.set(address, coordsText);
      
      showResult(coordsText);
      
    } else {
      // λ€μ²΄ API (BigDataCloud - μ΄κ³ μ†)
      const altResponse = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=37.5665&longitude=126.9780&localityLanguage=ko`);
      throw new Error('μ£Όμ† μ°ΎκΈ° μ‹¤ν¨');
    }
    
  } catch (error) {
    if (error.name === 'AbortError') {
      alert('β±οΈ κ²€μƒ‰μ‹κ°„ μ΄κ³Ό (5μ΄)\nμ§§μ€ μ£Όμ†λ΅ λ‹¤μ‹ μ‹λ„');
    } else {
      alert('β μ£Όμ† μ°ΎκΈ° μ‹¤ν¨\n\nλ„λ΅λ…μ£Όμ†λ΅ μ •ν™•ν μ…λ ¥:\n"μ„μΈνΉλ³„μ‹ κ°•λ‚¨κµ¬ ν…ν—¤λ€λ΅ 123"');
    }
  } finally {
    btn.disabled = false;
    btn.innerHTML = 'π” μΆν‘ μ°ΎκΈ° & λ³µμ‚¬';
  }
}

function showResult(coordsText) {
  navigator.clipboard.writeText(coordsText).then(() => {
    document.getElementById('coords').textContent = coordsText;
    document.getElementById('result').style.display = 'block';
    document.getElementById('result').scrollIntoView({behavior: 'smooth'});
  });
}

// URL νλΌλ―Έν„° μλ™ μ‹¤ν–‰
const urlParams = new URLSearchParams(location.search);
const addr = urlParams.get('address');
if (addr) {
  document.getElementById('address').value = decodeURIComponent(addr);
  setTimeout(findCoords, 500);
}

document.getElementById('address').addEventListener('keypress', e => {
  if (e.key === 'Enter') findCoords();
});
</script>
</body>
</html>
