<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë¶€ë™ì‚° ìœ„ì¹˜ ë„êµ¬</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=5aa11b53a04d1bb6f78c87e27a21a400&libraries=services"></script>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; background: #f0f2f5; }
        .card { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; width: 320px; }
        .btn { background: #fee500; border: none; padding: 18px; width: 100%; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 16px; transition: 0.3s; }
        .btn:hover { background: #fada00; transform: translateY(-2px); }
        .info { font-size: 13px; color: #888; margin-top: 15px; line-height: 1.5; }
        #addr-display { font-weight: bold; color: #333; margin-bottom: 15px; word-break: keep-all; }
    </style>
</head>
<body>
    <div class="card">
        <div id="addr-display">ì£¼ì†Œë¥¼ í™•ì¸ ì¤‘ì…ë‹ˆë‹¤...</div>
        <button class="btn" onclick="execute()">ğŸ“ ì§€ë„ ì—´ê¸° & ì¢Œí‘œ ì²˜ë¦¬</button>
        <div class="info" id="status">ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì¢Œí‘œ ë³µì‚¬ í›„<br>ë„¤ì´ë²„ ì§€ë„/ë¶€ë™ì‚°ì´ ì—´ë¦½ë‹ˆë‹¤.</div>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const addr = params.get('address');
        const existingCoord = params.get('coord'); // ë…¸ì…˜ì— ì´ë¯¸ ì¢Œí‘œê°€ ìˆë‹¤ë©´ ê°€ì ¸ì˜´
        const type = params.get('type') || 'SG';
        const deal = params.get('deal') || 'B2';

        if (addr) document.getElementById('addr-display').innerText = addr;

        function openMaps(lat, lon) {
            // ë„¤ì´ë²„ ì§€ë„ (ì£¼ì†Œ ê²€ìƒ‰ ê²°ê³¼)
            const naverMap = `https://map.naver.com/p/search/${encodeURIComponent(addr)}`;
            // ë„¤ì´ë²„ ë¶€ë™ì‚° (ì¢Œí‘œ ê¸°ì¤€ ìƒì„¸ í˜ì´ì§€)
            const naverLand = `https://new.land.naver.com/offices?ms=${lat},${lon},16&a=${type}&b=${deal}`;
            
            window.open(naverMap, '_blank');
            window.open(naverLand, '_blank');
        }

        function execute() {
            if (!addr) return alert("ì£¼ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.");
            const statusDisp = document.getElementById('status');

            // 1. ì´ë¯¸ ë…¸ì…˜ì— ì¢Œí‘œê°€ ìˆëŠ” ê²½ìš° ë°”ë¡œ ì§€ë„ ì—´ê¸°
            if (existingCoord && existingCoord.includes(",")) {
                const [lat, lon] = existingCoord.split(",").map(c => c.trim());
                statusDisp.innerHTML = "âœ… ê¸°ì¡´ ì¢Œí‘œë¡œ ì§€ë„ë¥¼ ì—½ë‹ˆë‹¤.";
                openMaps(lat, lon);
            } 
            // 2. ì¢Œí‘œê°€ ì—†ëŠ” ê²½ìš° ê²€ìƒ‰ í›„ ë³µì‚¬ ë° ì§€ë„ ì—´ê¸°
            else {
                const geocoder = new kakao.maps.services.Geocoder();
                geocoder.addressSearch(addr, function(result, status) {
                    if (status === kakao.maps.services.Status.OK) {
                        const lat = result[0].y;
                        const lon = result[0].x;
                        const coordText = lat + ", " + lon;

                        navigator.clipboard.writeText(coordText).then(() => {
                            statusDisp.innerHTML = "<b style='color:red'>ì¢Œí‘œ ë³µì‚¬ ì™„ë£Œ!</b><br>ë…¸ì…˜ ì¢Œí‘œ ì¹¸ì— Ctrl+V í•˜ì„¸ìš”.<br>ì ì‹œ í›„ ì§€ë„ê°€ ì—´ë¦½ë‹ˆë‹¤.";
                            setTimeout(() => openMaps(lat, lon), 1000);
                        });
                    } else {
                        alert("ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì£¼ì†Œê°€ ì •í™•í•œì§€ í™•ì¸í•´ ì£¼ì„¸ìš”.");
                    }
                });
            }
        }
    </script>
</body>
</html>
