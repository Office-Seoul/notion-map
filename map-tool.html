<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ì£¼ì†Œâ†’ì¢Œí‘œ (ğŸ”¥ ì™„ë²½ CORS í•´ê²°)</title>
</head>
<body>
<h1>ğŸ“ ì£¼ì†Œ â†’ ì¢Œí‘œ ë³€í™˜</h1>
<input id="address" placeholder="ì˜ˆ: ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123" style="width:100%;padding:10px;font-size:16px;">
<button onclick="findCoords()" style="width:100%;padding:10px;font-size:16px;background:#03c75a;color:white;border:none;">ğŸ” ì¢Œí‘œ ì°¾ê¸° & ë³µì‚¬</button>
<div id="map" style="height:400px;border:1px solid #ddd;"></div>
<div id="result" style="display:none;padding:10px;background:#f0f9f4;border-left:4px solid #03c75a;">
  <strong>âœ… ì¢Œí‘œ ë³µì‚¬ ì™„ë£Œ!</strong><br>
  <div id="coords" style="background:#333;color:#0f0;padding:10px;font-family:monospace;"></div>
</div>

<script>
// ğŸ”¥ CORS ì™„ì „ í•´ê²°: ëª¨ë“  ë¬´ë£Œ API í”„ë¡ì‹œ ìš°íšŒ
async function findCoords() {
  const address = document.getElementById('address').value.trim();
  if (!address) return alert('ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
  
  const btn = document.querySelector('button');
  btn.disabled = true;
  btn.innerHTML = 'â³ ê²€ìƒ‰ì¤‘...';
  
  try {
    // CORS í”„ë¡ì‹œ + OpenStreetMap (ê°€ì¥ ì•ˆì •ì )
    const proxyUrl = 'https://api.allorigins.win/get?url=';
    const apiUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&limit=1&addressdetails=1&countrycodes=kr`;
    
    const response = await fetch(proxyUrl + encodeURIComponent(apiUrl));
    const proxyData = await response.json();
    const data = JSON.parse(proxyData.contents);
    
    if (data && data.length > 0) {
      const lat = parseFloat(data[0].lat);
      const lng = parseFloat(data[0].lon);
      
      // ì¢Œí‘œ ë³µì‚¬
      const coordsText = `${lat.toFixed(6)},${lng.toFixed(6)}`;
      await navigator.clipboard.writeText(coordsText);
      
      document.getElementById('coords').textContent = coordsText;
      document.getElementById('result').style.display = 'block';
      document.getElementById('result').scrollIntoView();
      
      // Google ì§€ë„ ì„ë² ë“œ
      document.getElementById('map').innerHTML = `
        <iframe width="100%" height="400" frameborder="0" style="border-radius:8px;"
          src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3241!2d${lng}!3d${lat}!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0:0x0!2z${lat.toFixed(6)},${lng.toFixed(6)}!5e0!3m2!1sko!2skr!4v1630000000000"
          allowfullscreen loading="lazy">
        </iframe>
      `;
      
    } else {
      throw new Error('ì£¼ì†Œ ì°¾ê¸° ì‹¤íŒ¨');
    }
    
  } catch (error) {
    alert('âŒ ì£¼ì†Œ ì°¾ê¸° ì‹¤íŒ¨\n\në„ë¡œëª…ì£¼ì†Œë¡œ ì •í™•íˆ ì…ë ¥:\n"ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123"');
  } finally {
    btn.disabled = false;
    btn.innerHTML = 'ğŸ” ì¢Œí‘œ ì°¾ê¸° & ë³µì‚¬';
  }
}

// URL íŒŒë¼ë¯¸í„° ìë™ ì‹¤í–‰
const urlParams = new URLSearchParams(location.search);
const addr = urlParams.get('address');
if (addr) {
  document.getElementById('address').value = decodeURIComponent(addr);
  setTimeout(findCoords, 1000);
}

document.getElementById('address').addEventListener('keypress', e => {
  if (e.key === 'Enter') findCoords();
});
</script>
</body>
</html>
