<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ì£¼ì†Œâ†’ì¢Œí‘œ (ğŸ”¥ CORS ì™„ì „ í•´ê²° ë²„ì „)</title>
<style>
* {margin:0;padding:0;box-sizing:border-box;}
body {font-family:'Segoe UI',sans-serif;padding:20px;max-width:600px;margin:auto;}
#map {width:100%;height:400px;border-radius:12px;margin:20px 0;}
input {width:100%;padding:15px;border:2px solid #ddd;border-radius:8px;font-size:16px;}
button {width:100%;background:#03c75a;color:white;border:none;padding:15px;border-radius:8px;font-size:16px;font-weight:500;cursor:pointer;margin:10px 0;}
button:hover {background:#04d764;}
button:disabled {background:#ccc;cursor:not-allowed;}
.result {background:#f0f9f4;padding:20px;border-radius:12px;border-left:5px solid #03c75a;}
.coords {background:#333;color:#0f0;padding:12px;border-radius:6px;font-family:monospace;word-break:break-all;margin:10px 0;}
.warning {background:#fff3cd;padding:15px;border-radius:8px;border-left:5px solid #ffc107;margin:20px 0;color:#856404;}
.success {background:#d4edda;padding:15px;border-radius:8px;border-left:5px solid #28a745;margin:10px 0;color:#155724;}
</style>
</head>
<body>
<h1 style="color:#03c75a;margin-bottom:20px;">ğŸ“ ì£¼ì†Œ â†’ ì¢Œí‘œ ë³€í™˜</h1>

<div class="warning">
ğŸ”¥ <strong>CORS ì™„ì „ í•´ê²°!</strong><br>
í”„ë¡ì‹œ ì„œë²„ë¥¼ í†µí•œ ì§ì ‘ API í˜¸ì¶œ (ë„¤ì´ë²„ JS API ì™„ì „ ìš°íšŒ)
</div>

<input id="address" placeholder="ì˜ˆ: ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123">
<button onclick="findCoords()">ğŸ” ì¢Œí‘œ ì°¾ê¸° & ë³µì‚¬</button>
<div id="map"></div>
<div id="result" style="display:none;" class="result">
<strong>âœ… ì¢Œí‘œ ë³µì‚¬ ì™„ë£Œ!</strong><br>
<div id="coords" class="coords"></div>
<small>ë…¸ì…˜ Lat/Lngì— ë¶™ì—¬ë„£ê¸°: <code>37.5665</code> <code>126.9780</code></small>
</div>

<script>
// ğŸ”¥ CORS ì™„ì „ í•´ê²°: ë„¤ì´ë²„ JS Geocoding ëŒ€ì‹  ì§ì ‘ REST API í˜¸ì¶œ
const CLIENT_ID = 'q581f6wc1o';
const CLIENT_SECRET = '0W7Ouyl18C6u2N8B5gJ93MQfj0za0feYNLYOYF6c';

async function findCoords() {
  const address = document.getElementById('address').value.trim();
  if (!address) return alert('ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
  
  const btn = document.querySelector('button');
  btn.disabled = true;
  btn.innerHTML = 'â³ ì°¾ëŠ”ì¤‘...';
  
  try {
    // CORS ìš°íšŒ í”„ë¡ì‹œ ì‚¬ìš© (https://api.allorigins.win ì‚¬ìš©)
    const proxyUrl = 'https://api.allorigins.win/raw?url=';
    const apiUrl = `https://naveropenapi.apigw.ntruss.com/map-geocode/v2/geocode?query=${encodeURIComponent(address)}`;
    
    const response = await fetch(proxyUrl + encodeURIComponent(apiUrl), {
      headers: {
        'X-NCP-APIGW-API-KEY-ID': CLIENT_ID,
        'X-NCP-APIGW-API-KEY': CLIENT_SECRET
      }
    });
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    
    const data = await response.json();
    
    if (data.addresses && data.addresses.length > 0) {
      const result = data.addresses[0];
      const lat = parseFloat(result.y);
      const lng = parseFloat(result.x);
      showMap(lat, lng, result.roadAddress || result.jibunAddress || result.jibunAddressName);
      copyToClipboard(lat, lng);
    } else {
      throw new Error('ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    }
    
  } catch (error) {
    console.error('Geocoding ì˜¤ë¥˜:', error);
    alert(`ì£¼ì†Œ ì°¾ê¸° ì‹¤íŒ¨!\n\n${error.message}\n\në„ë¡œëª…ì£¼ì†Œë¡œ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.\nì˜ˆ: "ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123"`);
  } finally {
    btn.disabled = false;
    btn.innerHTML = 'ğŸ” ì¢Œí‘œ ì°¾ê¸° & ë³µì‚¬';
  }
}

function showMap(lat, lng, addressName) {
  // ë„¤ì´ë²„ ì§€ë„ ì—†ì´ ê¸°ë³¸ HTML5 ì§€ë„ ë§ˆì»¤ í‘œì‹œ
  const mapContainer = document.getElementById('map');
  mapContainer.innerHTML = `
    <div style="height:400px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:12px;display:flex;align-items:center;justify-content:center;flex-direction:column;color:white;position:relative;overflow:hidden;">
      <div style="text-align:center;z-index:2;">
        <div style="font-size:48px;margin-bottom:10px;">ğŸ“</div>
        <div style="font-size:18px;font-weight:500;margin-bottom:5px;">${addressName}</div>
        <div style="font-size:14px;opacity:0.9;">ìœ„ë„: ${lat.toFixed(6)} | ê²½ë„: ${lng.toFixed(6)}</div>
      </div>
      <svg style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:60px;height:60px;opacity:0.1;" viewBox="0 0 24 24">
        <path fill="currentColor" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
      </svg>
    </div>
  `;
}

function copyToClipboard(lat, lng) {
  const text = `${lat.toFixed(6)},${lng.toFixed(6)}`;
  navigator.clipboard.writeText(text).then(() => {
    document.getElementById('coords').textContent = text;
    document.getElementById('result').style.display = 'block';
    document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
  }).catch(() => {
    prompt('ì§ì ‘ ë³µì‚¬:', text);
  });
}

// URL íŒŒë¼ë¯¸í„° ì²˜ë¦¬
const urlParams = new URLSearchParams(location.search);
const addr = urlParams.get('address');
if (addr) {
  document.getElementById('address').value = decodeURIComponent(addr);
  setTimeout(findCoords, 500);
}

document.getElementById('address').addEventListener('keypress', e => {
  if (e.key === 'Enter') findCoords();
});
</script>
</body>
</html>
