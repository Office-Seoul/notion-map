<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ì£¼ì†Œâ†’ì¢Œí‘œ (Parser-blocking í•´ê²°)</title>
</head>
<body>
<input id="address" placeholder="ì£¼ì†Œ ìž…ë ¥">
<button onclick="findCoords()">ì¢Œí‘œ ì°¾ê¸°</button>
<div id="map" style="height:400px;"></div>
<div id="coords" style="display:none;"></div>

<script>
// ðŸ”¥ Parser-blocking ì™„ì „ í•´ê²°: ì™„ì „ ë¹„ë™ê¸° ë¡œë“œ
let naverMapsReady = false;

function loadNaverMaps() {
  return new Promise((resolve) => {
    if (naverMapsReady) {
      resolve();
      return;
    }
    
    const script = document.createElement('script');
    script.src = 'https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=q581f6wc1o&ncpClientSecret=0W7Ouyl18C6u2N8B5gJ93MQfj0za0feYNLYOYF6c&submodules=geocoder';
    script.async = true;
    script.defer = true;
    script.onload = () => {
      naverMapsReady = true;
      console.log('âœ… ë„¤ì´ë²„ ì§€ë„ ì™„ì „ ë¡œë“œ');
      resolve();
    };
    script.onerror = () => {
      console.log('âŒ ë„¤ì´ë²„ ì§€ë„ ë¡œë“œ ì‹¤íŒ¨');
      resolve(); // ì‹¤íŒ¨í•´ë„ ì§„í–‰
    };
    document.head.appendChild(script);
  });
}

async function findCoords() {
  const address = document.getElementById('address').value.trim();
  if (!address) return alert('ì£¼ì†Œ ìž…ë ¥!');
  
  // API ëŒ€ê¸°
  await loadNaverMaps();
  
  if (!window.naver?.maps?.Service) {
    alert('ì§€ë„ API ë¡œë“œ ì‹¤íŒ¨\nCORS 401: ë„¤ì´ë²„ í´ë¼ìš°ë“œ IP ì œí•œ ì„¤ì • í•„ìš”');
    return;
  }
  
  naver.maps.Service.geocode({
    query: address
  }, function(status, response) {
    if (status === naver.maps.Service.Status.OK) {
      const result = response.v2.addresses[0];
      const lat = parseFloat(result.y);
      const lng = parseFloat(result.x);
      
      document.getElementById('coords').textContent = `${lat.toFixed(6)},${lng.toFixed(6)}`;
      document.getElementById('coords').style.display = 'block';
      
      const map = new naver.maps.Map('map', {
        center: new naver.maps.LatLng(lat, lng),
        zoom: 17
      });
      
      new naver.maps.Marker({
        position: new naver.maps.LatLng(lat, lng),
        map: map
      });
      
    } else {
      alert('âŒ CORS 401 ì—ëŸ¬\n\në„¤ì´ë²„ í´ë¼ìš°ë“œ ì½˜ì†” â†’ Maps API â†’ IP ì œí•œ\n185.199.108.153 ì¶”ê°€ í•„ìš”');
    }
  });
}

document.getElementById('address').addEventListener('keypress', e => {
  if (e.key === 'Enter') findCoords();
});
</script>
</body>
</html>
