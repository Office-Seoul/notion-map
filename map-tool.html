<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ì£¼ì†Œâ†’ì¢Œí‘œ (ë„¤ì´ë²„ ì „ìš©)</title>
</head>
<body>
<h1>ğŸ“ ì£¼ì†Œ â†’ ì¢Œí‘œ ë³€í™˜ (ë„¤ì´ë²„)</h1>
<div style="background:#ffebee;padding:15px;border-left:4px solid #f44336;margin-bottom:20px;">
<strong>âš ï¸ CORS 401 ì—ëŸ¬ í•´ê²° í•„ìš”</strong><br>
ë„¤ì´ë²„ í´ë¼ìš°ë“œ ì½˜ì†” â†’ Application â†’ Maps ì•± â†’ IP ì œí•œì—<br>
<code>185.199.108.153</code> ì¶”ê°€ í›„ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”
</div>

<input id="address" placeholder="êµ¬/ë„ë¡œëª… ì£¼ì†Œ ëª¨ë‘ OK (ì˜ˆ: ì—­ì‚¼ë™ 717-15)" style="width:100%;padding:12px;font-size:16px;border:1px solid #ddd;">
<button onclick="findCoords()" style="width:100%;padding:12px;font-size:16px;background:#03c75a;color:white;border:none;margin:10px 0;cursor:pointer;">ğŸ” ì¢Œí‘œ ì°¾ê¸° & ë³µì‚¬</button>
<div id="result" style="display:none;padding:15px;background:#e8f5e8;border-left:4px solid #4caf50;">
  <strong>âœ… ì¢Œí‘œ ë³µì‚¬ ì™„ë£Œ!</strong><br>
  <div id="coords" style="background:#333;color:#0f0;padding:12px;font-family:monospace;border-radius:4px;margin-top:10px;"></div>
</div>

<script>
// ë„¤ì´ë²„ ì§€ë„ API ë¹„ë™ê¸° ë¡œë“œ
let naverReady = false;
const script = document.createElement('script');
script.src = 'https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=q581f6wc1o&ncpClientSecret=0W7Ouyl18C6u2N8B5gJ93MQfj0za0feYNLYOYF6c&submodules=geocoder';
script.async = true;
script.defer = true;
script.onload = () => { naverReady = true; console.log('âœ… ë„¤ì´ë²„ API ë¡œë“œì™„ë£Œ'); };
document.head.appendChild(script);

async function findCoords() {
  const address = document.getElementById('address').value.trim();
  if (!address) return alert('ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
  
  const btn = document.querySelector('button');
  btn.disabled = true;
  btn.innerHTML = 'â³ ê²€ìƒ‰ì¤‘...';
  
  // API ëŒ€ê¸° (ìµœëŒ€ 3ì´ˆ)
  const startTime = Date.now();
  while (!naverReady && Date.now() - startTime < 3000) {
    await new Promise(r => setTimeout(r, 100));
  }
  
  if (!window.naver?.maps?.Service) {
    alert('âŒ ë„¤ì´ë²„ API ë¡œë“œ ì‹¤íŒ¨\n\nCORS 401 ì—ëŸ¬ í•´ê²°:\n1. ë„¤ì´ë²„ í´ë¼ìš°ë“œ ì½˜ì†”\n2. Application â†’ Maps ì•±\n3. IP ì œí•œ â†’ 185.199.108.153 ì¶”ê°€');
    btn.disabled = false;
    btn.innerHTML = 'ğŸ” ì¢Œí‘œ ì°¾ê¸° & ë³µì‚¬';
    return;
  }
  
  naver.maps.Service.geocode({
    query: address
  }, function(status, response) {
    btn.disabled = false;
    btn.innerHTML = 'ğŸ” ì¢Œí‘œ ì°¾ê¸° & ë³µì‚¬';
    
    if (status === naver.maps.Service.Status.OK) {
      const result = response.v2.addresses[0];
      const lat = parseFloat(result.y);
      const lng = parseFloat(result.x);
      const coordsText = `${lat.toFixed(6)},${lng.toFixed(6)}`;
      
      // ìë™ ë³µì‚¬
      navigator.clipboard.writeText(coordsText).then(() => {
        document.getElementById('coords').textContent = coordsText;
        document.getElementById('coords').title = `${result.roadAddress || result.jibunAddress}`;
        document.getElementById('result').style.display = 'block';
        document.getElementById('result').scrollIntoView({behavior: 'smooth'});
      });
      
    } else {
      alert(`âŒ ì‹¤íŒ¨ (${status})\n\ní•´ê²°ë°©ë²•:\nâ€¢ ë„¤ì´ë²„ í´ë¼ìš°ë“œ â†’ Application â†’ Maps\nâ€¢ IP ì œí•œ â†’ 185.199.108.153 í—ˆìš©\n\ní…ŒìŠ¤íŠ¸ ì£¼ì†Œ: "ì„œìš¸ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™ 717-15"`);
    }
  });
}

// URL ìë™ ì‹¤í–‰
const urlParams = new URLSearchParams(location.search);
const addr = urlParams.get('address');
if (addr) {
  document.getElementById('address').value = decodeURIComponent(addr);
  setTimeout(findCoords, 1500);
}

document.getElementById('address').addEventListener('keypress', e => {
  if (e.key === 'Enter') findCoords();
});
</script>
</body>
</html>
